---
description: "Twitter風SNSアプリ - プロジェクト全体の仕様とルール"
globs: ["**"]
alwaysApply: true
---

# Twitter 風 SNS アプリ - プロジェクト仕様ルール

このファイルは、Twitter 風 SNS アプリの実装に関する詳細な仕様とルールを定義します。

## プロジェクト概要

何気ないことをつぶやくことができる Twitter 風 SNS アプリケーション。

## 技術スタック

### フロントエンド

- **フレームワーク**: Next.js 15.x
- **言語**: TypeScript
- **認証**: Firebase Authentication

### バックエンド

- **フレームワーク**: Laravel 8.x
- **言語**: PHP

## 機能要件

### 1. ユーザー認証

#### 実装方法

- Firebase Authentication を使用
- メールアドレスとパスワードによる認証

#### ログイン処理

- **エンドポイント**: `/api/auth/login` (Laravel) または Firebase SDK (Next.js)
- **バリデーション**:
  - メールアドレス: 入力必須
  - パスワード: 入力必須

#### 新規登録処理

- **エンドポイント**: `/api/auth/register` (Laravel) または Firebase SDK (Next.js)
- **バリデーション**:
  - ユーザーネーム: 入力必須、20 文字以内
  - メールアドレス: 入力必須、メール形式
  - パスワード: 入力必須、6 文字以上

### 2. 投稿機能

#### 投稿の一覧表示

- **エンドポイント**: `GET /api/posts` (Laravel)
- **表示内容**:
  - 投稿したユーザー名
  - 投稿内容
  - 投稿日時
  - いいね数
  - コメント数

#### 投稿の追加

- **エンドポイント**: `POST /api/posts` (Laravel)
- **バリデーション**:
  - 投稿内容: 入力必須、120 文字以内
- **認証**: ログインユーザーのみ投稿可能

#### 投稿の削除

- **エンドポイント**: `DELETE /api/posts/{id}` (Laravel)
- **認証**: 投稿者のみ削除可能
- **UI**: バツマークをクリックで削除

### 3. いいね機能

#### 実装要件

- **エンドポイント**: `POST /api/posts/{id}/like` (Laravel)
- **動作**: ハートマークをクリックでいいねの追加/削除を切り替え
- **表示**: いいね数がリアルタイムで更新される
- **認証**: ログインユーザーのみいいね可能

#### データ構造

- ユーザーは 1 つの投稿に対して 1 回のみいいね可能（トグル機能）

### 4. コメント機能

#### コメント画面への遷移

- **UI**: 矢印マークをクリックでコメント画面に遷移
- **ルート**: `/posts/{id}/comments` (Next.js)

#### コメントの一覧表示

- **エンドポイント**: `GET /api/posts/{id}/comments` (Laravel)
- **表示内容**:
  - コメントしたユーザー名
  - コメント内容
  - コメント日時

#### コメントの追加

- **エンドポイント**: `POST /api/posts/{id}/comments` (Laravel)
- **バリデーション**:
  - コメント内容: 入力必須、120 文字以内
- **認証**: ログインユーザーのみコメント可能

## バリデーションルール詳細

### ログイン処理

```php
// Laravel側のバリデーション例
[
    'email' => 'required|email',
    'password' => 'required'
]
```

### 新規登録処理

```php
// Laravel側のバリデーション例
[
    'username' => 'required|string|max:20',
    'email' => 'required|email|unique:users',
    'password' => 'required|string|min:6'
]
```

### 投稿追加

```php
// Laravel側のバリデーション例
[
    'content' => 'required|string|max:120'
]
```

### コメント追加

```php
// Laravel側のバリデーション例
[
    'content' => 'required|string|max:120'
]
```

## データベース設計ガイドライン

### テーブル構造

#### users テーブル

- `id`: 主キー
- `firebase_uid`: Firebase Authentication の UID（一意制約）
- `username`: ユーザーネーム（最大 20 文字）
- `email`: メールアドレス
- `created_at`, `updated_at`: タイムスタンプ

#### posts テーブル

- `id`: 主キー
- `user_id`: 外部キー（users.id）
- `content`: 投稿内容（最大 120 文字）
- `created_at`, `updated_at`: タイムスタンプ

#### likes テーブル

- `id`: 主キー
- `user_id`: 外部キー（users.id）
- `post_id`: 外部キー（posts.id）
- `created_at`, `updated_at`: タイムスタンプ
- **ユニーク制約**: `user_id` と `post_id` の組み合わせ

#### comments テーブル

- `id`: 主キー
- `user_id`: 外部キー（users.id）
- `post_id`: 外部キー（posts.id）
- `content`: コメント内容（最大 120 文字）
- `created_at`, `updated_at`: タイムスタンプ

## 実装ガイドライン

### Laravel 側の実装

#### コントローラ命名規則

- 既存の`.cursorrules`に従い、単数形のパスカルケースを使用
- 例: `PostController.php`, `CommentController.php`, `LikeController.php`

#### API レスポンス形式

- 成功時: JSON 形式でデータを返す
- エラー時: 適切な HTTP ステータスコードとエラーメッセージを返す

```php
// 成功レスポンス例
return response()->json([
    'success' => true,
    'data' => $data
], 200);

// エラーレスポンス例
return response()->json([
    'success' => false,
    'message' => 'エラーメッセージ'
], 400);
```

#### 認証ミドルウェア

- Firebase Authentication のトークンを検証するミドルウェアを作成
- 保護されたルートには認証ミドルウェアを適用

### Next.js 側の実装

#### ページ構造

- `/`: 投稿一覧ページ
- `/login`: ログインページ
- `/register`: 新規登録ページ
- `/posts/[id]/comments`: コメントページ

#### コンポーネント命名規則

- パスカルケースを使用
- 例: `PostList.tsx`, `PostItem.tsx`, `CommentForm.tsx`

#### 状態管理

- 投稿一覧、いいね状態、コメント一覧などの状態管理を適切に実装
- React Hooks（useState, useEffect 等）または状態管理ライブラリを使用

#### Firebase Authentication 統合

- Firebase SDK を使用して認証状態を管理
- 認証トークンを Laravel API リクエストのヘッダーに含める

## UI/UX 要件

### 投稿一覧画面

- 投稿カード形式で表示
- 各投稿に以下を表示:
  - ユーザー名
  - 投稿内容
  - 投稿日時
  - いいねボタン（ハートマーク）といいね数
  - コメントボタン（矢印マーク）とコメント数
  - 削除ボタン（バツマーク）- 自分の投稿のみ表示

### コメント画面

- 元の投稿を上部に表示
- コメント一覧を表示
- コメント入力フォームを下部に配置

### リアルタイム更新

- いいねをクリックした際、即座に UI を更新
- 投稿・コメント追加後、一覧を更新

## セキュリティ要件

### 認証・認可

- すべての API エンドポイントで認証を必須とする（公開エンドポイントを除く）
- 投稿の削除は投稿者のみ可能
- ユーザー情報の取得は認証済みユーザーのみ

### 入力値検証

- フロントエンドとバックエンドの両方でバリデーションを実装
- XSS 対策: ユーザー入力の適切なエスケープ
- SQL インジェクション対策: Eloquent ORM の使用

### CORS 設定

- Next.js アプリからのリクエストのみ許可するよう CORS を設定

## エラーハンドリング

### フロントエンド

- API エラーレスポンスを適切に処理
- ユーザーフレンドリーなエラーメッセージを表示
- ネットワークエラー時のリトライ機能を検討

### バックエンド

- 適切な HTTP ステータスコードを返す
- エラーログを記録
- 機密情報を含むエラーメッセージを返さない

## テスト要件

### バリデーションテスト

- すべてのバリデーションルールに対するテストを作成
- 境界値テスト（文字数制限など）を実施

### 機能テスト

- 投稿の CRUD 操作
- いいね機能のトグル動作
- コメント機能の動作
- 認証・認可の動作

## パフォーマンス要件

### データベース

- 投稿一覧の取得時に N+1 問題を回避（Eager Loading の使用）
- 必要に応じてインデックスを設定

### フロントエンド

- ページネーションまたは無限スクロールを実装
- 画像の最適化（必要に応じて）

## 既存ルールとの整合性

このプロジェクトでは、既存の`.cursorrules`で定義されている命名規則を遵守してください：

- **モデル**: 単数形、パスカルケース（例: `Post.php`, `User.php`）
- **テーブル**: 複数形、スネークケース（例: `posts`, `users`）
- **コントローラ**: 単数形、パスカルケース（例: `PostController.php`）
- **クラス**: 単数形、パスカルケース
- **メソッド**: キャメルケース（例: `getPostById()`）
- **変数**: スネークケース（例: `$user_name`, `$post_id`）

## 実装チェックリスト

### 認証機能

- [ ] Firebase Authentication の設定
- [ ] ログイン機能の実装
- [ ] 新規登録機能の実装
- [ ] 認証状態の管理

### 投稿機能

- [ ] 投稿一覧表示
- [ ] 投稿追加機能
- [ ] 投稿削除機能
- [ ] バリデーション実装

### いいね機能

- [ ] いいね追加/削除のトグル機能
- [ ] いいね数の表示
- [ ] いいね状態の表示

### コメント機能

- [ ] コメント画面への遷移
- [ ] コメント一覧表示
- [ ] コメント追加機能
- [ ] バリデーション実装

### UI/UX

- [ ] レスポンシブデザイン
- [ ] ローディング状態の表示
- [ ] エラーメッセージの表示
- [ ] リアルタイム更新

### セキュリティ

- [ ] 認証ミドルウェアの実装
- [ ] 認可チェックの実装
- [ ] 入力値検証
- [ ] CORS 設定
